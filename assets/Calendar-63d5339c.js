var e=Object.defineProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,t=(a,o,l)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,c=(e,c)=>{for(var n in c||(c={}))o.call(c,n)&&t(e,n,c[n]);if(a)for(var n of a(c))l.call(c,n)&&t(e,n,c[n]);return e},n=(e,a,o)=>new Promise((l,t)=>{var c=e=>{try{s(o.next(e))}catch(a){t(a)}},n=e=>{try{s(o.throw(e))}catch(a){t(a)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(c,n);s((o=o.apply(e,a)).next())});import{c as s,r as i,b as r}from"./vendor-0df5e6d0.js";import{i as d,a as g,b as u,F as h,I as m}from"./calendar-a00b4ef7.js";import{m as f,A as p}from"./animations-7bba3a4b.js";const y=()=>{const{t:e}=s(),[a,o]=i.useState(null),[l,t]=i.useState([]),[y,v]=i.useState(!0),b=i.useRef(null),x=()=>n(void 0,null,function*(){try{let a="",o="local";try{const e=new AbortController,l=setTimeout(()=>e.abort(),3e3),t=yield fetch("https://calendar.google.com/calendar/ical/c75a77e742a41f2fb3b453f5824cea38d85a9072ef85fc1e22da9fd37843cd91%40group.calendar.google.com/public/basic.ics",{method:"GET",headers:{Accept:"text/calendar"},signal:e.signal});if(clearTimeout(l),!t.ok)throw new Error("Google Calendar ICS not accessible");a=yield t.text(),o="google-ics",console.log("Successfully loaded from Google Calendar ICS")}catch(e){console.log("Google Calendar ICS not accessible, falling back to local file");const l=yield fetch("/calendar.ics");a=yield l.text(),o="local"}const l=m.parse(a),c=new m.Component(l).getAllSubcomponents("vevent"),n=[];c.forEach(e=>{try{const a=e.getFirstPropertyValue("summary"),l=e.getFirstPropertyValue("dtstart"),t=e.getFirstPropertyValue("dtend"),c=e.getFirstPropertyValue("uid");if(a&&l){const e=l.toJSDate(),s=t?t.toJSDate():new Date(e.getTime()+36e5);n.push({id:c||`event-${Date.now()}-${Math.random()}`,title:a,start:e,end:s,display:"block",backgroundColor:"#6366f1",borderColor:"#4f46e5",textColor:"#ffffff",source:o})}}catch(a){console.warn("Error parsing event:",a)}}),t(n),console.log(`Loaded ${n.length} events from ${o}`)}catch(a){console.error("Failed to load calendar data:",a),t([])}});i.useEffect(()=>{n(void 0,null,function*(){console.log("ðŸ”„ Starting calendar initialization..."),v(!0);try{console.log("ðŸŒ Checking Google access...");const e=yield n(void 0,null,function*(){return new Promise(e=>{const a=new AbortController,o=setTimeout(()=>{a.abort(),console.log("Google access check timeout, using local calendar"),e(!1)},5e3);fetch("https://www.google.com/favicon.ico",{method:"HEAD",mode:"no-cors",signal:a.signal,cache:"no-cache"}).then(()=>{clearTimeout(o),e(!0)}).catch(()=>{clearTimeout(o),console.log("Google not accessible, using local calendar"),e(!1)})})});console.log("ðŸ“Š Google accessible:",e),o(e),e||(console.log("ðŸ“… Loading local calendar..."),yield x())}catch(e){console.error("âŒ Calendar initialization error:",e),o(!1),yield x()}finally{console.log("âœ… Calendar initialization complete"),v(!1)}})},[]);const j={plugins:[d,g,u],initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"timeGridWeek,dayGridMonth"},height:500,events:l,eventDisplay:"block",dayMaxEvents:3,moreLinkClick:"popover",slotMinTime:"08:00:00",slotMaxTime:"20:00:00",slotDuration:"02:00:00",slotLabelInterval:"02:00:00",eventClick:e=>{e.jsEvent.preventDefault()},eventContent:a=>{const o="zh-cn"===e("calendar.locale",{defaultValue:"en"})?"zh-CN":"en-US",l=`${a.event.start.toLocaleTimeString(o,{hour:"2-digit",minute:"2-digit",hour12:!1})}-${a.event.end.toLocaleTimeString(o,{hour:"2-digit",minute:"2-digit",hour12:!1})}`;return{html:`<div class="fc-event-title-container">\n          <div class="fc-event-title fc-sticky">${e("calendar.busy")}</div>\n          <div class="fc-event-time">${l}</div>\n        </div>`}},locale:e("calendar.locale",{defaultValue:"en"}),buttonText:{today:e("calendar.today"),month:e("calendar.month"),week:e("calendar.week"),day:e("calendar.day")}};return y?r.jsx("section",{id:"calendar",className:"section",children:r.jsxs(f.div,{className:"calendar-container",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[r.jsxs("div",{className:"section-header",children:[r.jsx("h2",{className:"section-title",children:e("calendar.title")}),r.jsx("p",{className:"section-subtitle",children:e("calendar.subtitle")})]}),r.jsxs("div",{className:"calendar-loading",children:[r.jsx("div",{className:"loading-spinner"}),r.jsx("p",{children:e("calendar.loading")})]})]})}):r.jsx("section",{id:"calendar",className:"section",children:r.jsxs(f.div,{className:"calendar-container",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[r.jsxs("div",{className:"section-header",children:[r.jsx("h2",{className:"section-title",children:e("calendar.title")}),r.jsx("p",{className:"section-subtitle",children:e("calendar.subtitle")})]}),r.jsx(p,{mode:"wait",children:a?r.jsxs(f.div,{className:"google-calendar-wrapper",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.5,ease:"easeInOut"},children:[r.jsx("div",{className:"calendar-source-indicator",children:r.jsxs("span",{className:"source-badge google-badge",children:[r.jsx("i",{className:"icon-google"}),e("calendar.source.google")]})}),r.jsx("iframe",{src:"https://calendar.google.com/calendar/embed?src=c75a77e742a41f2fb3b453f5824cea38d85a9072ef85fc1e22da9fd37843cd91@group.calendar.google.com&ctz=Asia%2FShanghai&mode=WEEK&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=0&showCalendars=0&showTz=0&wkst=1&bgcolor=%23ffffff&color=%23B1365F",style:{border:"none",width:"100%",height:"500px",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.1)"},title:"Google Calendar"})]},"google-calendar"):r.jsxs(f.div,{className:"local-calendar-wrapper",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.5,ease:"easeInOut"},children:[r.jsx("div",{className:"calendar-source-indicator",children:r.jsxs("span",{className:"source-badge local-badge",children:[r.jsx("i",{className:"icon-local"}),l.length>0&&"google-ics"===l[0].source?e("calendar.source.googleIcs"):e("calendar.source.local")]})}),r.jsx("div",{className:"fullcalendar-container",children:r.jsx(h,c({ref:b},j))})]},"local-calendar")}),r.jsx("div",{className:"calendar-footer",children:r.jsx("p",{className:"calendar-note",children:e("calendar.note")})})]})})};export{y as default};
